heat_template_version: rocky

description: >
  OpenStack Designate base service. Shared for all Designate services

parameters:
  ServiceData:
    default: {}
    description: Dictionary packing service data
    type: json
  ServiceNetMap:
    default: {}
    description: Mapping of service_name -> network name. Typically set
                 via parameter_defaults in the resource registry.  This
                 mapping overrides those in ServiceNetMapDefaults.
    type: json
  DefaultPasswords:
    default: {}
    type: json
  RoleName:
    default: ''
    description: Role name on which the service is applied
    type: string
  RoleParameters:
    default: {}
    description: Parameters specific to the role
    type: json
  EndpointMap:
    default: {}
    description: Mapping of service endpoint -> protocol. Typically set
                 via parameter_defaults in the resource registry.
    type: json
  Debug:
    type: boolean
    default: false
    description: Set to True to enable debugging on all services.
  DesignateDebug:
    default: ''
    description: Set to True to enable debugging Designate services.
    type: string
  EnableConfigPurge:
    type: boolean
    default: false
    description: >
        Remove configuration that is not generated by TripleO. Used to avoid
        configuration remnants after upgrades.
  RabbitPassword:
    description: The password for RabbitMQ
    type: string
    hidden: true
  RabbitUserName:
    default: guest
    description: The username for RabbitMQ
    type: string
  RabbitClientUseSSL:
    default: false
    description: >
        Rabbit client subscriber parameter to specify
        an SSL connection to the RabbitMQ host.
    type: string
  RabbitClientPort:
    default: 5672
    description: Set rabbit subscriber port, change this if using SSL
    type: number
  NotificationDriver:
    type: string
    default: 'noop'
    description: Driver or drivers to handle sending notifications.

parameter_groups:
- label: deprecated
  description: |
   The following parameters are deprecated and will be removed. They should not
   be relied on for new deployments. If you have concerns regarding deprecated
   parameters, please contact the TripleO development team on IRC or the
   OpenStack mailing list.
  parameters:
  - RabbitPassword
  - RabbitUserName
  - RabbitClientUseSSL
  - RabbitClientPort

conditions:
  service_debug_unset: {equals : [{get_param: DesignateDebug}, '']}

outputs:
  role_data:
    description: Base role data for Designate services
    value:
       service_name: designate_base
       config_settings:
         designate::logging::debug:
          if:
          - service_debug_unset
          - {get_param: Debug }
          - {get_param: DesignateDebug }
         designate::purge_config: {get_param: EnableConfigPurge}
         designate::notification_driver: {get_param: NotificationDriver}
