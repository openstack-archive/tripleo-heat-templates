environments:
  -
    name: enable-designate
    title: Enable Designate Service
    description: |
      EXPERIMENTAL: This service is not considered ready for production and
      should only be used for development and test purposes at this time.

      This environment enables the Designate services and provides sample
      configuration values for other services to allow them to integrate with
      Designate.
    resource_registry:
      OS::TripleO::Services::DesignateApi: ../docker/services/designate-api.yaml
      OS::TripleO::Services::DesignateCentral: ../docker/services/designate-central.yaml
      OS::TripleO::Services::DesignateProducer: ../docker/services/designate-producer.yaml
      OS::TripleO::Services::DesignateWorker: ../docker/services/designate-worker.yaml
      OS::TripleO::Services::DesignateMDNS: ../docker/services/designate-mdns.yaml
    files:
      puppet/services/neutron-plugin-ml2.yaml:
        parameters:
          - NeutronPluginExtensions
      puppet/services/neutron-dhcp.yaml:
        parameters:
          - NeutronEnableInternalDNS
      puppet/services/designate-central.yaml:
        parameters:
          - DesignatePools
    sample_values:
      NeutronPluginExtensions: qos,port_security,dns
      NeutronEnableInternalDNS: True
      DesignatePools: |-
        |
            - name: default
              # The name is immutable. There will be no option to change the name after
              # creation and the only way will to change it will be to delete it
              # (and all zones associated with it) and recreate it.
              description: Default Pool

              attributes: {}

              # List out the NS records for zones hosted within this pool
              # This should be a record that is created outside of designate, that
              # points to the public IP of the controller node.
              ns_records:
                - hostname: ns1-1.example.org.
                  priority: 1

              # List out the nameservers for this pool. These are the actual BIND servers.
              # We use these to verify changes have propagated to all nameservers.
              nameservers:
                - host: 127.0.0.1
                  port: 53

              # List out the targets for this pool. For BIND there will be one
              # entry for each BIND server, as we have to run rndc command on each server
              targets:
                - type: bind9
                  description: BIND9 Server 1

                  # List out the designate-mdns servers from which BIND servers should
                  # request zone transfers (AXFRs) from.
                  # This should be the IP of the controller node.
                  # If you have multiple controllers you can add multiple masters
                  # by running designate-mdns on them, and adding them here.
                  masters:
                    - host: 127.0.0.1
                      port: 5354

                  # BIND Configuration options
                  options:
                    host: 127.0.0.1
                    port: 53
                    rndc_host: 127.0.0.1
                    rndc_port: 953
                    rndc_key_file: /etc/rndc.key
